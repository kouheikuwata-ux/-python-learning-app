<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pythonç·´ç¿’ã‚¢ãƒ—ãƒª</title>
    
    <!-- Google Analytics è¨­å®š -->
    <script src="analytics-config.js"></script>
    
    <!-- Google Analytics 4 (GA4) -->
    <script>
        // è¨­å®šã®æº–å‚™ã‚’å¾…ã¤
        document.addEventListener('DOMContentLoaded', function() {
            if (window.ANALYTICS_CONFIG && !window.ANALYTICS_CONFIG.DEVELOPMENT_MODE) {
                // æœ¬ç•ªç’°å¢ƒã§ã®ã¿GA4ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã‚€
                const script = document.createElement('script');
                script.async = true;
                script.src = `https://www.googletagmanager.com/gtag/js?id=${window.ANALYTICS_CONFIG.GA_MEASUREMENT_ID}`;
                document.head.appendChild(script);
                
                script.onload = function() {
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    window.gtag = gtag;
                    gtag('js', new Date());
                    gtag('config', window.ANALYTICS_CONFIG.GA_MEASUREMENT_ID);
                    console.log('Google Analytics 4 initialized with ID:', window.ANALYTICS_CONFIG.GA_MEASUREMENT_ID);
                };
            } else {
                console.log('Google Analytics disabled in development mode');
            }
        });
    </script>
    
<link rel="stylesheet" href="style.css">

</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>ğŸ Pythonç·´ç¿’ã‚¢ãƒ—ãƒª</h1>
            <p>ã¾ãšã¯çœŸä¼¼ã—ã¦æ›¸ã„ã¦ã¿ã‚ˆã†ï¼</p>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="progressText">é€²æ—: 0%</div>
        </header>

        <div class="lesson-menu" id="lessonMenu"></div>

        <div class="main-content">
            <div class="lesson-content" id="lessonContent"></div>

            <div class="coding-area">
                <div class="step-indicator" id="stepIndicator">
                    ã‚¹ãƒ†ãƒƒãƒ—1: ã¾ãšã¯ä¸‹ã®Pythonã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾æ›¸ãå†™ã—ã¦ã¿ã‚ˆã†ï¼
                </div>

                <div class="copy-code-section">
                    <div class="copy-code-label">
                        ğŸ ã¾ãšã¯ã“ã®Pythonã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾æ›¸ãå†™ã—ã¦ãã ã•ã„
                    </div>
                    <div class="copy-code" id="copyCode">print("ã“ã‚“ã«ã¡ã¯ã€Pythonï¼")</div>
                    <button class="copy-btn" id="copyBtn">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    <button class="preview-btn" id="previewBtn">ğŸ‘€ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                </div>

                <div class="editor-label">
                    âœï¸ ã“ã“ã«ä¸Šã®Pythonã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå†™ã—ã¦ãã ã•ã„ï¼š
                </div>
                
                <textarea 
                    class="code-editor" 
                    id="codeEditor" 
                    placeholder="ä¸Šã®Pythonã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«æ›¸ãå†™ã—ã¦ãã ã•ã„...">
                </textarea>

                <div class="button-row">
                    <button class="btn btn-primary" id="runBtn">â–¶ï¸ å®Ÿè¡Œ</button>
                    <button class="btn btn-secondary" id="hintBtn">ğŸ’¡ ãƒ’ãƒ³ãƒˆ</button>
                    <button class="btn btn-warning" id="showAnswerBtn">ğŸ“– å®Œå…¨ãªè§£ç­”</button>
                </div>

                <div class="editor-label">ğŸ“¤ å®Ÿè¡Œçµæœï¼š</div>
                <div class="python-simulator" id="outputArea">
                    <span class="python-prompt">>>> </span>ã“ã“ã«Pythonã®å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                </div>

                <div class="explanation-section" id="explanationSection" style="display: none;">
                    <div class="explanation-title">
                        ğŸ” ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜
                    </div>
                    <div class="explanation-text" id="explanationText"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">Ã—</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        const lessons = [
            {
                id: 1,
                title: "æ–‡å­—ã‚’è¡¨ç¤ºã—ã¦ã¿ã‚ˆã†",
                content: `
                    <h2>ğŸ ãƒ¬ãƒƒã‚¹ãƒ³1: æ–‡å­—ã‚’è¡¨ç¤ºã—ã¦ã¿ã‚ˆã†</h2>
                    <p>Pythonãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ç¬¬ä¸€æ­©ã¯ã€Œæ–‡å­—ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã€ã§ã™ã€‚</p>
                    <p>Pythonã§ã¯ <code>print()</code> ã‚’ä½¿ã£ã¦æ–‡å­—ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>ã€Œã“ã‚“ã«ã¡ã¯ã€Pythonï¼ã€</strong>ã¨ã„ã†æ–‡å­—ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ <code>print()</code> = æ–‡å­—ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°</p>
                    <p>â€¢ æ–‡å­—åˆ—ã¯ <code>" "</code> ã§å›²ã‚€</p>
                    <p>â€¢ Pythonã¯è¡Œã®çµ‚ã‚ã‚Šã«ã‚»ãƒŸã‚³ãƒ­ãƒ³ãŒä¸è¦</p>
                `,
                copyCode: 'print("ã“ã‚“ã«ã¡ã¯ã€Pythonï¼")',
                hint: "print() ã®ä¸­ã«ã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚“ã æ–‡å­—ã‚’æ›¸ãã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. print() â†’ ã€Œç”»é¢ã«è¡¨ç¤ºã—ãªã•ã„ã€ã¨ã„ã†å‘½ä»¤
2. "ã“ã‚“ã«ã¡ã¯ã€Pythonï¼" â†’ è¡¨ç¤ºã—ãŸã„æ–‡å­—ï¼ˆæ–‡å­—åˆ—ï¼‰

ã¤ã¾ã‚Šã€Œ"ã“ã‚“ã«ã¡ã¯ã€Pythonï¼"ã¨ã„ã†æ–‡å­—ã‚’ç”»é¢ã«è¡¨ç¤ºã—ãªã•ã„ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("ã“ã‚“ã«ã¡ã¯ã€Pythonï¼")
            },
            {
                id: 2,
                title: "å¤‰æ•°ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†",
                content: `
                    <h2>ğŸ“¦ ãƒ¬ãƒƒã‚¹ãƒ³2: å¤‰æ•°ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†</h2>
                    <p>å¤‰æ•°ã¯ã€Œãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ç®±ã€ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚</p>
                    <p>Pythonã§ã¯ã€å¤‰æ•°ã®å®£è¨€ãŒç‰¹ã«ä¸è¦ã§ã€ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>ã€Œç§ã®åå‰ã¯â—‹â—‹ã§ã™ã€</strong>ã‚’å¤‰æ•°ã‚’ä½¿ã£ã¦è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ å¤‰æ•°å <code>= å€¤</code> ã§å¤‰æ•°ã‚’ä½œã‚‹</p>
                    <p>â€¢ <code>+</code> ã§æ–‡å­—ã‚’ã¤ãªã’ã‚‹</p>
                    <p>â€¢ Pythonã¯å‹å®£è¨€ãŒä¸è¦ï¼ˆè‡ªå‹•åˆ¤åˆ¥ï¼‰</p>
                `,
                copyCode: 'name = "å¤ªéƒ"\nprint("ç§ã®åå‰ã¯" + name + "ã§ã™")',
                hint: "name = \"å¤ªéƒ\" ã§å¤‰æ•°ã‚’ä½œã‚Šã€print() ã®ä¸­ã§ + ã‚’ä½¿ã£ã¦æ–‡å­—åˆ—ã¨å¤‰æ•°ã‚’ã¤ãªã’ã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. name = "å¤ªéƒ" â†’ nameã¨ã„ã†å¤‰æ•°ã«"å¤ªéƒ"ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹
2. print("ç§ã®åå‰ã¯" + name + "ã§ã™") â†’ 3ã¤ã®éƒ¨åˆ†ã‚’ã¤ãªã’ã¦è¡¨ç¤º

çµæœ: "ç§ã®åå‰ã¯å¤ªéƒã§ã™" ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("ç§ã®åå‰ã¯") && output.includes("ã§ã™")
            },
            {
                id: 3,
                title: "ifæ–‡ã§æ¡ä»¶åˆ†å²",
                content: `
                    <h2>ğŸ”€ ãƒ¬ãƒƒã‚¹ãƒ³3: ifæ–‡ã§æ¡ä»¶åˆ†å²</h2>
                    <p>ifæ–‡ã‚’ä½¿ã†ã¨ã€Œã‚‚ã—â—‹â—‹ãªã‚‰â–³â–³ã™ã‚‹ã€ã¨ã„ã†å‡¦ç†ãŒã§ãã¾ã™ã€‚</p>
                    <p>Pythonã®ifæ–‡ã¯ã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼ˆå­—ä¸‹ã’ï¼‰ã§æ§‹é€ ã‚’è¡¨ç¾ã™ã‚‹ã®ãŒç‰¹å¾´ã§ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>å¹´é½¢ã«ã‚ˆã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰ãˆã‚‹</strong>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ <code>if æ¡ä»¶:</code> = ã‚‚ã—æ¡ä»¶ãŒæ­£ã—ã„ãªã‚‰</p>
                    <p>â€¢ <code>else:</code> = ãã†ã§ãªã‘ã‚Œã°</p>
                    <p>â€¢ ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼ˆ4ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ã§ç¯„å›²ã‚’ç¤ºã™</p>
                `,
                copyCode: 'age = 18\nif age >= 20:\n    print("æˆäººã§ã™ã­ï¼")\nelse:\n    print("ã¾ã æœªæˆå¹´ã§ã™ã­")',
                hint: 'age = 18 ã§å¤‰æ•°ã‚’ä½œã‚Šã€if age >= 20: ã§æ¡ä»¶åˆ¤å®šã—ã¾ã™ã€‚æ¡ä»¶ã®å¾Œã¯ : ã‚’ä»˜ã‘ã€æ¬¡ã®è¡Œã¯4ã‚¹ãƒšãƒ¼ã‚¹å­—ä¸‹ã’ã—ã¾ã™ã€‚',
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. age = 18 â†’ ageã¨ã„ã†å¤‰æ•°ã«18ã‚’å…¥ã‚Œã‚‹
2. if age >= 20: â†’ ã€Œã‚‚ã—ageãŒ20ä»¥ä¸Šãªã‚‰ã€
3.     print("æˆäººã§ã™ã­ï¼") â†’ æ¡ä»¶ãŒæ­£ã—ã„æ™‚ã«å®Ÿè¡Œï¼ˆ4ã‚¹ãƒšãƒ¼ã‚¹å­—ä¸‹ã’ï¼‰
4. else: â†’ ã€Œãã†ã§ãªã‘ã‚Œã°ã€  
5.     print("ã¾ã æœªæˆå¹´ã§ã™ã­") â†’ æ¡ä»¶ãŒé•ã†æ™‚ã«å®Ÿè¡Œï¼ˆ4ã‚¹ãƒšãƒ¼ã‚¹å­—ä¸‹ã’ï¼‰

ä»Šå›ã¯ageãŒ18ãªã®ã§ã€ã€Œã¾ã æœªæˆå¹´ã§ã™ã­ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("ã¾ã æœªæˆå¹´ã§ã™ã­")
            },
            {
                id: 4,
                title: "foræ–‡ã§ç¹°ã‚Šè¿”ã—",
                content: `
                    <h2>ğŸ”„ ãƒ¬ãƒƒã‚¹ãƒ³4: foræ–‡ã§ç¹°ã‚Šè¿”ã—</h2>
                    <p>foræ–‡ã‚’ä½¿ã†ã¨ã€åŒã˜å‡¦ç†ã‚’ä½•å›ã‚‚è‡ªå‹•ã§ç¹°ã‚Šè¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
                    <p>Pythonã®foræ–‡ã¯ã€range()ã¨çµ„ã¿åˆã‚ã›ã¦ã¨ã¦ã‚‚ç°¡å˜ã«æ›¸ã‘ã¾ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>1ã‹ã‚‰5ã¾ã§é †ç•ªã«æ•°å­—ã‚’è¡¨ç¤º</strong>ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ <code>for i in range(n):</code> = nå›ç¹°ã‚Šè¿”ã™</p>
                    <p>â€¢ <code>range(1, 6)</code> = 1ã‹ã‚‰5ã¾ã§ï¼ˆ6ã¯å«ã¾ãªã„ï¼‰</p>
                    <p>â€¢ ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã§ç¯„å›²ã‚’ç¤ºã™</p>
                `,
                copyCode: 'for i in range(1, 6):\n    print(str(i) + "ç•ªç›®")',
                hint: "for i in range(1, 6): ã§1ã‹ã‚‰5ã¾ã§ç¹°ã‚Šè¿”ã—ã€str(i)ã§æ•°å€¤ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. for i in range(1, 6): â†’ ç¹°ã‚Šè¿”ã—ã®è¨­å®š
   - i ã¨ã„ã†å¤‰æ•°ãŒ1, 2, 3, 4, 5ã¨é †ç•ªã«å¤‰åŒ–
   - range(1, 6) = 1ä»¥ä¸Š6æœªæº€ = 1,2,3,4,5

2.     print(str(i) + "ç•ªç›®") â†’ ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†
   - str(i) â†’ æ•°å€¤iã‚’æ–‡å­—åˆ—ã«å¤‰æ›
   - + ã§æ–‡å­—åˆ—ã‚’çµåˆ

å®Ÿè¡Œçµæœï¼š1ç•ªç›®ã€2ç•ªç›®ã€3ç•ªç›®ã€4ç•ªç›®ã€5ç•ªç›® ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("1ç•ªç›®") && output.includes("2ç•ªç›®") && output.includes("5ç•ªç›®")
            },
            {
                id: 5,
                title: "é–¢æ•°ã‚’ä½œã£ã¦ã¿ã‚ˆã†",
                content: `
                    <h2>âš™ï¸ ãƒ¬ãƒƒã‚¹ãƒ³5: é–¢æ•°ã‚’ä½œã£ã¦ã¿ã‚ˆã†</h2>
                    <p>é–¢æ•°ã¯ã€Œå‡¦ç†ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã€ã§ã™ã€‚ä¸€åº¦ä½œã‚Œã°ä½•åº¦ã§ã‚‚ä½¿ãˆã¾ã™ã€‚</p>
                    <p>Pythonã®é–¢æ•°ã¯ <code>def</code> ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§å®šç¾©ã—ã¾ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œã‚‹é–¢æ•°</strong>ã‚’ä½œã£ã¦ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ <code>def é–¢æ•°å():</code> = é–¢æ•°ã‚’å®šç¾©ã™ã‚‹</p>
                    <p>â€¢ <code>return</code> = çµæœã‚’è¿”ã™</p>
                    <p>â€¢ é–¢æ•°å() = é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹</p>
                `,
                copyCode: 'def greet(name):\n    return "ã“ã‚“ã«ã¡ã¯ã€" + name + "ã•ã‚“ï¼"\n\nprint(greet("å¤ªéƒ"))\nprint(greet("èŠ±å­"))',
                hint: "def greet(name): ã§é–¢æ•°ã‚’å®šç¾©ã—ã€return ã§çµæœã‚’è¿”ã—ã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. def greet(name): â†’ greetã¨ã„ã†åå‰ã®é–¢æ•°ã‚’å®šç¾©
2.     return "ã“ã‚“ã«ã¡ã¯ã€" + name + "ã•ã‚“ï¼" â†’ æŒ¨æ‹¶æ–‡ã‚’ä½œã£ã¦è¿”ã™
3. print(greet("å¤ªéƒ")) â†’ é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è¡¨ç¤º
4. print(greet("èŠ±å­")) â†’ åŒã˜é–¢æ•°ã‚’åˆ¥ã®åå‰ã§å®Ÿè¡Œ

é–¢æ•°ã‚’ä½œã‚‹ã“ã¨ã§ã€åŒã˜ã‚ˆã†ãªå‡¦ç†ã‚’ç°¡å˜ã«å†åˆ©ç”¨ã§ãã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("ã“ã‚“ã«ã¡ã¯ã€å¤ªéƒã•ã‚“") && output.includes("ã“ã‚“ã«ã¡ã¯ã€èŠ±å­ã•ã‚“")
            },
            {
                id: 6,
                title: "ãƒªã‚¹ãƒˆã‚’ä½¿ã£ã¦ã¿ã‚ˆã†",
                content: `
                    <h2>ğŸ“‹ ãƒ¬ãƒƒã‚¹ãƒ³6: ãƒªã‚¹ãƒˆã‚’ä½¿ã£ã¦ã¿ã‚ˆã†</h2>
                    <p>ãƒªã‚¹ãƒˆã¯ã€Œè¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦å…¥ã‚Œã‚‹ç®±ã€ã§ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>æœç‰©ã®ãƒªã‚¹ãƒˆ</strong>ã‚’ä½œã£ã¦ã€ã™ã¹ã¦è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ <code>[]</code> = ãƒªã‚¹ãƒˆã‚’ä½œã‚‹</p>
                    <p>â€¢ <code>len(ãƒªã‚¹ãƒˆ)</code> = ãƒªã‚¹ãƒˆã®é•·ã•ã‚’å–å¾—</p>
                `,
                copyCode: 'fruits = ["ã‚Šã‚“ã”", "ãƒãƒŠãƒŠ", "ã‚ªãƒ¬ãƒ³ã‚¸"]\n\nfor i in range(len(fruits)):\n    print(str(i + 1) + "ç•ªç›®: " + fruits[i])\n\nprint("åˆè¨ˆ" + str(len(fruits)) + "ç¨®é¡ã®æœç‰©ãŒã‚ã‚Šã¾ã™")',
                hint: "ãƒªã‚¹ãƒˆã¯ [] ã§ä½œã‚Šã€ä¸­ã«æ–‡å­—åˆ—ã‚’ , ã§åŒºåˆ‡ã£ã¦å…¥ã‚Œã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. fruits = ["ã‚Šã‚“ã”", "ãƒãƒŠãƒŠ", "ã‚ªãƒ¬ãƒ³ã‚¸"] â†’ æœç‰©ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆ
2. for i in range(len(fruits)): â†’ ãƒªã‚¹ãƒˆã®é•·ã•åˆ†ç¹°ã‚Šè¿”ã—
3. fruits[i] â†’ ãƒªã‚¹ãƒˆã®iç•ªç›®ã®è¦ç´ ã‚’å–å¾—

å®Ÿè¡Œçµæœï¼š1ç•ªç›®: ã‚Šã‚“ã”ã€2ç•ªç›®: ãƒãƒŠãƒŠ...ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("ã‚Šã‚“ã”") && output.includes("ãƒãƒŠãƒŠ") && output.includes("ç¨®é¡ã®æœç‰©")
            },
            {
                id: 7,
                title: "è¾æ›¸ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†",
                content: `
                    <h2>ğŸ·ï¸ ãƒ¬ãƒƒã‚¹ãƒ³7: è¾æ›¸ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†</h2>
                    <p>è¾æ›¸ã¯ã€Œåå‰ä»˜ãã§ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ä»•çµ„ã¿ã€ã§ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>äººã®æƒ…å ±</strong>ã‚’è¾æ›¸ã«ã¾ã¨ã‚ã¦è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ <code>{}</code> = è¾æ›¸ã‚’ä½œã‚‹</p>
                    <p>â€¢ <code>"ã‚­ãƒ¼": å€¤</code> = ãƒ‡ãƒ¼ã‚¿ã‚’ãƒšã‚¢ã§ä¿å­˜</p>
                `,
                copyCode: 'person = {\n    "name": "ç”°ä¸­å¤ªéƒ",\n    "age": 25,\n    "hobby": "èª­æ›¸"\n}\n\nprint("åå‰: " + person["name"])\nprint("å¹´é½¢: " + str(person["age"]) + "æ­³")\nprint("è¶£å‘³: " + person["hobby"])',
                hint: "è¾æ›¸ã¯ {} ã§ä½œã‚Šã€\"ã‚­ãƒ¼\": å€¤ ã®å½¢ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. person = { ... } â†’ personã¨ã„ã†è¾æ›¸ã‚’ä½œæˆ
2. "name": "ç”°ä¸­å¤ªéƒ" â†’ nameã¨ã„ã†ã‚­ãƒ¼ã«"ç”°ä¸­å¤ªéƒ"ã¨ã„ã†å€¤ã‚’ä¿å­˜
3. person["name"] â†’ è¾æ›¸ã®nameã®å€¤ã‚’å–å¾—

è¾æ›¸ã‚’ä½¿ã†ã¨ã€é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†ã—ã¦ç®¡ç†ã§ãã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("ç”°ä¸­å¤ªéƒ") && output.includes("25æ­³") && output.includes("èª­æ›¸")
            },
            {
                id: 8,
                title: "è¨ˆç®—ã‚’ã—ã¦ã¿ã‚ˆã†",
                content: `
                    <h2>ğŸ§® ãƒ¬ãƒƒã‚¹ãƒ³8: è¨ˆç®—ã‚’ã—ã¦ã¿ã‚ˆã†</h2>
                    <p>Pythonã¯æ•°å€¤è¨ˆç®—ãŒã¨ã¦ã‚‚å¾—æ„ã§ã™ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>ãƒ†ã‚¹ãƒˆã®ç‚¹æ•°</strong>ã®åˆè¨ˆã¨å¹³å‡ã‚’è¨ˆç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ <code>sum()</code> = ãƒªã‚¹ãƒˆã®åˆè¨ˆã‚’è¨ˆç®—</p>
                    <p>â€¢ <code>/</code> = å‰²ã‚Šç®—</p>
                `,
                copyCode: 'scores = [85, 92, 78, 96, 88]\n\ntotal = sum(scores)\naverage = total / len(scores)\n\nprint("åˆè¨ˆç‚¹: " + str(total) + "ç‚¹")\nprint("å¹³å‡ç‚¹: " + str(round(average, 1)) + "ç‚¹")',
                hint: "sum()é–¢æ•°ã§ãƒªã‚¹ãƒˆã®åˆè¨ˆã‚’ç°¡å˜ã«è¨ˆç®—ã§ãã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. scores = [85, 92, 78, 96, 88] â†’ ãƒ†ã‚¹ãƒˆã®ç‚¹æ•°ã‚’ãƒªã‚¹ãƒˆã«ä¿å­˜
2. total = sum(scores) â†’ ãƒªã‚¹ãƒˆã®åˆè¨ˆã‚’è¨ˆç®—
3. average = total / len(scores) â†’ å¹³å‡ã‚’è¨ˆç®—

sum()ã¯Pythonã®ä¾¿åˆ©ãªçµ„ã¿è¾¼ã¿é–¢æ•°ã§ã™ã€‚`,
                checkFunction: (output) => output.includes("åˆè¨ˆç‚¹: 439ç‚¹") && output.includes("å¹³å‡ç‚¹")
            },
            {
                id: 9,
                title: "é–¢æ•°ã§è¨ˆç®—æ©Ÿã‚’ä½œã‚ã†",
                content: `
                    <h2>ğŸ§® ãƒ¬ãƒƒã‚¹ãƒ³9: é–¢æ•°ã§è¨ˆç®—æ©Ÿã‚’ä½œã‚ã†</h2>
                    <p>ã„ã‚ã„ã‚ãªè¨ˆç®—ã‚’ã™ã‚‹é–¢æ•°ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>å››å‰‡æ¼”ç®—</strong>ãŒã§ãã‚‹é–¢æ•°ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š è¦šãˆã‚‹ã“ã¨ï¼š</h3>
                    <p>â€¢ è¤‡æ•°ã®é–¢æ•°ã‚’ä½œã‚‹</p>
                    <p>â€¢ é–¢æ•°ã®å¼•æ•°ã¨æˆ»ã‚Šå€¤</p>
                `,
                copyCode: 'def add(a, b):\n    return a + b\n\ndef multiply(a, b):\n    return a * b\n\nprint("10 + 5 =", add(10, 5))\nprint("10 Ã— 5 =", multiply(10, 5))',
                hint: "å„æ¼”ç®—ç”¨ã®é–¢æ•°ã‚’ä½œã‚Šã€return ã§çµæœã‚’è¿”ã—ã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. def add(a, b): return a + b â†’ è¶³ã—ç®—é–¢æ•°
2. def multiply(a, b): return a * b â†’ æ›ã‘ç®—é–¢æ•°
3. print("10 + 5 =", add(10, 5)) â†’ é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è¡¨ç¤º

é–¢æ•°ã‚’ä½œã‚‹ã“ã¨ã§ã€è¨ˆç®—å‡¦ç†ã‚’å†åˆ©ç”¨ã§ãã¾ã™ã€‚`,
                checkFunction: (output) => output.includes("= 15") && output.includes("= 50")
            },
            {
                id: 10,
                title: "ç·åˆæ¼”ç¿’ï¼šå­¦ç”Ÿç®¡ç†",
                content: `
                    <h2>ğŸ“ ãƒ¬ãƒƒã‚¹ãƒ³10: ç·åˆæ¼”ç¿’ï¼šå­¦ç”Ÿç®¡ç†</h2>
                    <p>ã“ã‚Œã¾ã§å­¦ã‚“ã ã“ã¨ã‚’å…¨éƒ¨ä½¿ã£ã¦ã€æœ¬æ ¼çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ¯ ä»Šå›ã®ç›®æ¨™ï¼š</h3>
                    <p><strong>å­¦ç”Ÿã®æˆç¸¾ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </strong>ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <h3>ğŸ“š ä»Šå›ä½¿ã†ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ï¼š</h3>
                    <p>â€¢ è¾æ›¸ã®ãƒªã‚¹ãƒˆ</p>
                    <p>â€¢ é–¢æ•°ã§ã®åˆ¤å®šå‡¦ç†</p>
                    <p>â€¢ ä»Šã¾ã§å­¦ã‚“ã ã™ã¹ã¦ã®çŸ¥è­˜ã®ç·åˆæ´»ç”¨</p>
                `,
                copyCode: 'students = [\n    {"name": "ç”°ä¸­", "math": 85, "english": 78},\n    {"name": "ä½è—¤", "math": 92, "english": 88}\n]\n\ndef check_grade(math, english):\n    average = (math + english) / 2\n    if average >= 80:\n        return "å„ªç§€"\n    else:\n        return "åˆæ ¼"\n\nfor student in students:\n    grade = check_grade(student["math"], student["english"])\n    print(student["name"] + "ã•ã‚“: " + grade)',
                hint: "è¾æ›¸ã®ãƒªã‚¹ãƒˆã€é–¢æ•°ã§ã®åˆ¤å®šå‡¦ç†ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚",
                explanation: `ã“ã®ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œèª¬æ˜ï¼š

1. students â†’ å­¦ç”Ÿã®ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãƒªã‚¹ãƒˆ
2. check_gradeé–¢æ•° â†’ æˆç¸¾åˆ¤å®šã®ãƒ­ã‚¸ãƒƒã‚¯
3. foræ–‡ã§studentsãƒªã‚¹ãƒˆã®å„è¾æ›¸ã‚’å‡¦ç†

ã“ã‚Œã¾ã§å­¦ã‚“ã Pythonã®å…¨çŸ¥è­˜ã‚’ä½¿ã£ãŸæœ¬æ ¼çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚`,
                checkFunction: (output) => output.includes("ç”°ä¸­ã•ã‚“") && output.includes("ä½è—¤ã•ã‚“") && (output.includes("å„ªç§€") || output.includes("åˆæ ¼"))
            }
        ];

        let currentLesson = 1;
        let completedLessons = new Set();
        
        // Google Analytics ã‚¤ãƒ™ãƒ³ãƒˆè¿½è·¡é–¢æ•°
        function trackEvent(eventName, parameters = {}) {
            const config = window.ANALYTICS_CONFIG;
            
            if (config && !config.DEVELOPMENT_MODE && typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    event_category: 'python_learning',
                    ...parameters
                });
                console.log('GA Event tracked:', eventName, parameters);
            } else {
                console.log('GA Event (dev mode):', eventName, parameters);
            }
        }

        const lessonMenu = document.getElementById('lessonMenu');
        const lessonContent = document.getElementById('lessonContent');
        const stepIndicator = document.getElementById('stepIndicator');
        const copyCode = document.getElementById('copyCode');
        const copyBtn = document.getElementById('copyBtn');
        const previewBtn = document.getElementById('previewBtn');
        const codeEditor = document.getElementById('codeEditor');
        const outputArea = document.getElementById('outputArea');
        const runBtn = document.getElementById('runBtn');
        const hintBtn = document.getElementById('hintBtn');
        const showAnswerBtn = document.getElementById('showAnswerBtn');
        const modal = document.getElementById('modal');
        const modalBody = document.getElementById('modalBody');
        const modalClose = document.getElementById('modalClose');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const explanationSection = document.getElementById('explanationSection');
        const explanationText = document.getElementById('explanationText');

        function simulatePython(code) {
            const outputs = [];
            
            // ç‰¹å®šã®ãƒ¬ãƒƒã‚¹ãƒ³ã®ãŸã‚ã®å‡¦ç†
            if (code.includes('ã“ã‚“ã«ã¡ã¯ã€Python')) {
                outputs.push('ã“ã‚“ã«ã¡ã¯ã€Pythonï¼');
            } else if (code.includes('ç§ã®åå‰ã¯')) {
                outputs.push('ç§ã®åå‰ã¯å¤ªéƒã§ã™');
            } else if (code.includes('ã¾ã æœªæˆå¹´')) {
                outputs.push('ã¾ã æœªæˆå¹´ã§ã™ã­');
            } else if (code.includes('age >= 20')) {
                outputs.push('ã¾ã æœªæˆå¹´ã§ã™ã­');
            } else if (code.includes('ç•ªç›®') && code.includes('range')) {
                outputs.push('1ç•ªç›®');
                outputs.push('2ç•ªç›®');
                outputs.push('3ç•ªç›®');
                outputs.push('4ç•ªç›®');
                outputs.push('5ç•ªç›®');
            } else if (code.includes('greet')) {
                outputs.push('ã“ã‚“ã«ã¡ã¯ã€å¤ªéƒã•ã‚“ï¼');
                outputs.push('ã“ã‚“ã«ã¡ã¯ã€èŠ±å­ã•ã‚“ï¼');
            } else if (code.includes('fruits')) {
                outputs.push('1ç•ªç›®: ã‚Šã‚“ã”');
                outputs.push('2ç•ªç›®: ãƒãƒŠãƒŠ');  
                outputs.push('3ç•ªç›®: ã‚ªãƒ¬ãƒ³ã‚¸');
                outputs.push('åˆè¨ˆ3ç¨®é¡ã®æœç‰©ãŒã‚ã‚Šã¾ã™');
            } else if (code.includes('ç”°ä¸­å¤ªéƒ')) {
                outputs.push('åå‰: ç”°ä¸­å¤ªéƒ');
                outputs.push('å¹´é½¢: 25æ­³');
                outputs.push('è¶£å‘³: èª­æ›¸');
            } else if (code.includes('scores') && code.includes('sum')) {
                outputs.push('åˆè¨ˆç‚¹: 439ç‚¹');
                outputs.push('å¹³å‡ç‚¹: 87.8ç‚¹');
            } else if (code.includes('add') && code.includes('multiply')) {
                outputs.push('10 + 5 = 15');
                outputs.push('10 Ã— 5 = 50');
            } else if (code.includes('ç”°ä¸­') && code.includes('ä½è—¤')) {
                outputs.push('ç”°ä¸­ã•ã‚“: å„ªç§€');
                outputs.push('ä½è—¤ã•ã‚“: å„ªç§€');
            }
            
            return {
                output: outputs.join('\n'),
                hasError: false
            };
        }

        function saveProgress() {
            localStorage.setItem('pythonAppProgress', JSON.stringify([...completedLessons]));
            localStorage.setItem('pythonAppCurrentLesson', currentLesson.toString());
        }

        function loadProgress() {
            const saved = localStorage.getItem('pythonAppProgress');
            if (saved) {
                completedLessons = new Set(JSON.parse(saved));
            }
            
            const savedLesson = localStorage.getItem('pythonAppCurrentLesson');
            if (savedLesson) {
                currentLesson = parseInt(savedLesson);
            }
        }

        function createLessonMenu() {
            lessonMenu.innerHTML = '';
            
            lessons.forEach((lesson) => {
                const tab = document.createElement('button');
                tab.className = 'lesson-tab';
                tab.textContent = `${lesson.id}. ${lesson.title}`;
                
                if (lesson.id === currentLesson) {
                    tab.classList.add('active');
                }
                if (completedLessons.has(lesson.id)) {
                    tab.classList.add('completed');
                }
                
                tab.addEventListener('click', () => {
                    currentLesson = lesson.id;
                    showLesson(lesson.id);
                    saveProgress();
                });
                
                lessonMenu.appendChild(tab);
            });
        }

        function showLesson(lessonId) {
            const lesson = lessons.find(l => l.id === lessonId);
            if (!lesson) return;
            
            // ç¾åœ¨ã®ãƒ¬ãƒƒã‚¹ãƒ³é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²
            currentLessonStartTime = Date.now();
            
            // GA: ãƒ¬ãƒƒã‚¹ãƒ³é–‹å§‹ã‚’è¿½è·¡
            trackEvent('lesson_started', {
                lesson_id: lessonId,
                lesson_title: lesson.title
            });
            
            lessonContent.innerHTML = lesson.content;
            copyCode.textContent = lesson.copyCode.replace(/\\n/g, '\n');
            
            codeEditor.value = '';
            codeEditor.placeholder = 'ğŸ‘†ä¸Šã®Pythonã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«æ›¸ãå†™ã—ã¦ãã ã•ã„...';
            
            stepIndicator.textContent = 'ã‚¹ãƒ†ãƒƒãƒ—1: ã¾ãšã¯ä¸Šã®Pythonã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾æ›¸ãå†™ã—ã¦ã¿ã‚ˆã†ï¼';
            stepIndicator.style.background = '#e3f2fd';
            stepIndicator.style.borderColor = '#306998';
            stepIndicator.style.color = '#1976d2';
            
            outputArea.innerHTML = '<span class="python-prompt">>>> </span>ã“ã“ã«Pythonã®å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™';
            outputArea.className = 'python-simulator';
            
            explanationSection.style.display = 'none';
            
            createLessonMenu();
            updateProgress();
        }

        function copyToClipboard() {
            const lesson = lessons.find(l => l.id === currentLesson);
            if (!lesson) return;
            
            // GA: ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ã‚’è¿½è·¡
            trackEvent('code_copied', {
                lesson_id: currentLesson,
                lesson_title: lesson.title
            });
            
            const codeText = lesson.copyCode.replace(/\\n/g, '\n');
            
            navigator.clipboard.writeText(codeText).then(() => {
                copyBtn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†ï¼';
                copyBtn.style.background = '#28a745';
                
                setTimeout(() => {
                    copyBtn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼';
                    copyBtn.style.background = '#FFD43B';
                }, 1500);
            }).catch(() => {
                copyBtn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†ï¼';
                setTimeout(() => {
                    copyBtn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼';
                }, 1500);
            });
        }

        function showPreview() {
            const lesson = lessons.find(l => l.id === currentLesson);
            if (!lesson) return;
            
            // GA: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä½¿ç”¨ã‚’è¿½è·¡
            trackEvent('preview_used', {
                lesson_id: currentLesson,
                lesson_title: lesson.title
            });
            
            const result = simulatePython(lesson.copyCode);
            
            modalBody.innerHTML = `
                <h3>ğŸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼šã“ã®Pythonã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨...</h3>
                <div style="background:#1e1e1e;color:#ffffff;padding:15px;border-radius:8px;margin:15px 0;font-family:'Courier New',monospace;">
                    <span style="color:#00ff00;">>>> </span>${result.output}
                </div>
                <p><strong>ğŸ’¡ è§£èª¬ï¼š</strong></p>
                <div style="background:#f8f9fa;padding:15px;border-radius:8px;border:2px solid #dee2e6;">
                    ${lesson.explanation.replace(/\n/g, '<br>')}
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function runCode() {
            const code = codeEditor.value.trim();
            const lesson = lessons.find(l => l.id === currentLesson);
            
            // GA: ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã‚’è¿½è·¡
            trackEvent('code_executed', {
                lesson_id: currentLesson,
                lesson_title: lesson?.title,
                code_length: code.length
            });
            
            if (!code) {
                outputArea.innerHTML = '<span class="python-error">âš ï¸ Pythonã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>';
                return;
            }

            const result = simulatePython(code);
            
            outputArea.innerHTML = '<span class="python-prompt">>>> </span>' + result.output;
                
            if (lesson && lesson.checkFunction(result.output)) {
                outputArea.className = 'python-simulator output-success';
                outputArea.innerHTML += '<br><br><span style="color:#68d391;">ğŸ‰ æ­£è§£ã§ã™ï¼ç´ æ™´ã‚‰ã—ã„ï¼</span>';
                
                // GA: ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†ã‚’è¿½è·¡ï¼ˆæ‰€è¦æ™‚é–“ã‚’å«ã‚€ï¼‰
                const lessonDuration = Math.round((Date.now() - currentLessonStartTime) / 1000);
                trackEvent('lesson_completed', {
                    lesson_id: currentLesson,
                    lesson_title: lesson.title,
                    duration_seconds: lessonDuration
                });
                
                stepIndicator.textContent = 'ğŸ‰ ã‚¯ãƒªã‚¢ï¼æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã«é€²ã‚‚ã†ï¼';
                stepIndicator.style.background = '#d4edda';
                stepIndicator.style.borderColor = '#28a745';
                stepIndicator.style.color = '#155724';
                
                explanationText.innerHTML = lesson.explanation.replace(/\n/g, '<br>');
                explanationSection.style.display = 'block';
                
                completedLessons.add(currentLesson);
                saveProgress();
                createLessonMenu();
                updateProgress();
            } else {
                // GA: ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œå¤±æ•—ã‚’è¿½è·¡
                trackEvent('code_failed', {
                    lesson_id: currentLesson,
                    lesson_title: lesson?.title
                });
            }
        }

        function showHint() {
            const lesson = lessons.find(l => l.id === currentLesson);
            if (!lesson) return;
            
            // GA: ãƒ’ãƒ³ãƒˆä½¿ç”¨ã‚’è¿½è·¡
            trackEvent('hint_used', {
                lesson_id: currentLesson,
                lesson_title: lesson.title
            });
            
            modalBody.innerHTML = `
                <h3>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</h3>
                <p style="background:#e3f2fd;padding:15px;border-radius:8px;border:2px solid #306998;">
                    ${lesson.hint}
                </p>
                <h4>ğŸ“ ãŠæ‰‹æœ¬ã‚³ãƒ¼ãƒ‰ï¼š</h4>
                <pre style="background:#2d3748;color:#e2e8f0;padding:15px;border-radius:8px;font-family:'Courier New',monospace;">${lesson.copyCode.replace(/\\n/g, '\n')}</pre>
            `;
            
            modal.style.display = 'block';
        }

        function showAnswer() {
            const lesson = lessons.find(l => l.id === currentLesson);
            if (!lesson) return;
            
            // GA: è§£ç­”è¡¨ç¤ºã‚’è¿½è·¡
            trackEvent('answer_shown', {
                lesson_id: currentLesson,
                lesson_title: lesson.title
            });
            
            modalBody.innerHTML = `
                <h3>ğŸ“– å®Œå…¨ãªè§£ç­”</h3>
                <pre style="background:#2d3748;color:#e2e8f0;padding:20px;border-radius:8px;font-family:'Courier New',monospace;">${lesson.copyCode.replace(/\\n/g, '\n')}</pre>
                
                <h4>ğŸ” è©³ã—ã„è§£èª¬ï¼š</h4>
                <div style="background:#f8f9fa;padding:15px;border-radius:8px;border:2px solid #dee2e6;">
                    ${lesson.explanation.replace(/\n/g, '<br>')}
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function updateProgress() {
            const completionRate = Math.round((completedLessons.size / lessons.length) * 100);
            progressBar.style.width = completionRate + '%';
            progressText.textContent = `é€²æ—: ${completionRate}% (${completedLessons.size}/${lessons.length}ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†)`;
            
            // GA: é€²æ—æ›´æ–°ã‚’è¿½è·¡
            trackEvent('progress_updated', {
                completion_rate: completionRate,
                completed_lessons: completedLessons.size,
                total_lessons: lessons.length
            });
        }

        function setupKeyboardShortcuts() {
            codeEditor.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    this.value = this.value.substring(0, start) + '    ' + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + 4;
                }
                
                // GA: ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼æ“ä½œã‚’è¿½è·¡
                codeEditorInteractionCount++;
                if (codeEditorInteractionCount % 10 === 0) { // 10å›ã®æ“ä½œæ¯ã«è¿½è·¡
                    trackEvent('code_editor_activity', {
                        lesson_id: currentLesson,
                        interaction_count: codeEditorInteractionCount,
                        code_length: this.value.length
                    });
                }
            });
            
            // ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã¸ã®å…¥åŠ›ã‚’è¿½è·¡
            codeEditor.addEventListener('input', function() {
                trackUserInteraction('code_typing');
            });
            
            // ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹/ãƒ–ãƒ©ãƒ¼è¿½è·¡
            codeEditor.addEventListener('focus', function() {
                trackUserInteraction('code_editor_focus');
            });
        }

        function setupEventListeners() {
            runBtn.addEventListener('click', () => {
                trackUserInteraction('run_button_click');
                runCode();
            });
            hintBtn.addEventListener('click', () => {
                trackUserInteraction('hint_button_click');
                showHint();
            });
            showAnswerBtn.addEventListener('click', () => {
                trackUserInteraction('answer_button_click');
                showAnswer();
            });
            copyBtn.addEventListener('click', () => {
                trackUserInteraction('copy_button_click');
                copyToClipboard();
            });
            previewBtn.addEventListener('click', () => {
                trackUserInteraction('preview_button_click');
                showPreview();
            });
            modalClose.addEventListener('click', () => {
                trackUserInteraction('modal_close_click');
                closeModal();
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    trackUserInteraction('modal_backdrop_click');
                    closeModal();
                }
            });
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²
        let sessionStartTime = Date.now();
        let currentLessonStartTime = Date.now();
        
        // GA: ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“ã¨ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®çµ±è¨ˆã‚’è¿½è·¡
        function trackSessionData() {
            const sessionDuration = Math.round((Date.now() - sessionStartTime) / 1000);
            const currentLessonDuration = Math.round((Date.now() - currentLessonStartTime) / 1000);
            
            trackEvent('session_data', {
                session_duration_seconds: sessionDuration,
                current_lesson_duration_seconds: currentLessonDuration,
                current_lesson_id: currentLesson,
                completed_lessons_count: completedLessons.size,
                completion_rate: Math.round((completedLessons.size / lessons.length) * 100)
            });
        }
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
        window.addEventListener('beforeunload', () => {
            trackSessionData();
        });
        
        // å®šæœŸçš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ï¼ˆ5åˆ†æ¯ï¼‰
        setInterval(trackSessionData, 5 * 60 * 1000);
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆè¿½è·¡
        let userInteractionCount = 0;
        let codeEditorInteractionCount = 0;
        
        function trackUserInteraction(interactionType) {
            userInteractionCount++;
            trackEvent('user_interaction', {
                interaction_type: interactionType,
                total_interactions: userInteractionCount,
                current_lesson: currentLesson
            });
        }

        function initApp() {
            loadProgress();
            createLessonMenu();
            showLesson(currentLesson);
            setupEventListeners();
            setupKeyboardShortcuts();
            updateProgress();
            
            // GA: ã‚¢ãƒ—ãƒªåˆæœŸåŒ–ã‚’è¿½è·¡
            trackEvent('app_initialized', {
                initial_lesson: currentLesson,
                completed_lessons_count: completedLessons.size,
                user_agent: navigator.userAgent,
                screen_resolution: `${screen.width}x${screen.height}`
            });
        }

        document.addEventListener('DOMContentLoaded', initApp);
        window.addEventListener('beforeunload', saveProgress);

    </script>
</body>
</html>